

exports.main = function(context, request, callback) {
	if (request.event === "pinf/0/runtime/control/0#events/start") {
		return context.getRuntimeConfig(["daemon"], function(err, config) {
			if (err) return callback(err);
			if (config && config.running) {
				return context.updateRuntimeConfig(["daemon"], {
					startCount: config.startCount + 1
				}, callback);
			} else {
				return context.updateRuntimeConfig(["daemon"], {
					running: true,
					startCount: 0
				}, callback);
			}
		});
	} else
	if (request.event === "pinf/0/runtime/control/0#events/stop") {
		return context.clearRuntimeConfig(["daemon"], function(err) {
			if (err) return callback(err);
			return callback(null, {
				running: false
			});
		});
	}
	return callback(new Error("Event '" + request.event + "' not supported!"));
}

